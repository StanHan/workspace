<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.daikuan.platform.ma.dao.AStatisticsAdminApproveMapper">
    <insert id="statisticsAdminApprove" statementType="CALLABLE" parameterType="java.util.Date">
        {call proc_statistics_admin_approve(#{statisticsDate,jdbcType=DATE,mode=IN})}
    </insert>

    <select id="queryByProductIdAndType" resultType="AStatisticsAdminApproveEntity">
        SELECT admin_id, admin_name, sum(h09) h09, sum(h10) h10, sum(h11) h11, sum(h12) h12, sum(h13) h13, sum(h14) h14, sum(h15) h15, sum(h16) h16
            , sum(h17) h17, sum(h18) h18, sum(h19) h19, sum(h20) h20, max(last_approve_time) last_approve_time, sum(subtotal) subtotal, sum(subavg) subavg
        from a_statistics_admin_approve statistics
        WHERE type = #{1} AND DATE(statistics_time) = DATE(#{2})
        <if test="productId != null">
            AND product_id = #{productId}
        </if>
        <if test="adminId != null">
            AND admin_id = #{adminId}
        </if>
        GROUP BY admin_id;
    </select>
</mapper>